<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Crime Against Children in India</title>
		<meta name="description" content="">
		<link href="assets/css/bootstrap.min.css" rel="stylesheet">
		<link href="assets/css/bootstrap-responsive.min.css" rel="stylesheet">
		<link href="assets/css/leaflet.css" rel="stylesheet">
		<link href="assets/css/MarkerCluster.css" rel="stylesheet">
		<link href="assets/css/MarkerCluster.Default.css" rel="stylesheet">
		<link href="assets/css/style.css" rel="stylesheet">
	</head>
	<body>
		<div class="container">
			<div class="mashead">
				<h3>Crime Against Children in India</h3>
				<nav class="navbar navbar-default" role="navigation">
					<div class="collapse navbar-collapse">
						<ul class="nav navbar-nav">
							<li class="active"><a href="#">Home</a></li>
							<li><a href="#">Visualizations</a></li>
							<li><a href="#">About Us</a></li>
						</ul>
					</div>	
				</nav>	
			</div>	

			<div>
				<p class="lead">The data has been taken from <a href="http://data.gov.in/">Open Government Data (OGD) Platform India</a> and refers to details on district wise crimes against Children under various crime categories such as Murder, Rape, Kidnapping and Abduction, Foeticide, Abetment of suicide, Exposure and abandonment, Procuration of minor girls, Buying of girls for prostitution, Selling of girls for prostitution, Prohibition of child marriage act and Other Crimes.</p>
			</div>
			<h4>Displaying Data of Year 2012</h4>
			<div id="progress" class="progress progress-striped active"><div id="progress-bar" class="progress-bar" role="progressbar"  aria-valuemin="0" aria-valuemax="100" style="width: 30%"><span class="sr-only">Loading...</span></div></div>
			<div id="map"></div>
		</div>	
		<script src="assets/js/google-maps.js"></script>
		<script src="assets/js/jquery.min.js" type="text/javascript"></script>
		<script src="assets/js/bootstrap.min.js"></script>
		<script src="assets/js/leaflet.js"></script>
		<script src="assets/js/leaflet.markercluster-src.js"></script>
		<script src="assets/js/leaflet-google.js"></script>
		<script type="text/javascript">
			var googleLayer = new L.Google('ROADMAP');
			var map = new L.Map('map', {center: new L.LatLng(22, 78), zoom: 5});
			map.addLayer(googleLayer);
			
			var progress = document.getElementById('progress');
			var progressBar = document.getElementById('progress-bar');
			function updateProgressBar(processed, total, elapsed, layersArray)
			{
				if (elapsed > 5) 
				{
					// if it takes more than a second to load, display the progress bar:
					progress.style.display = 'block';
					loaded_value = Math.round(processed/total*1000)
					progressBar.style.width = loaded_value + '%';
				}
				if (processed === total) 
				{
					// all markers processed - hide the progress bar:
					progress.style.display = 'none';
				}
			}
			function executeAsync(func) 
			{
				setTimeout(func, 100);
			}
			var markers = L.markerClusterGroup({ chunkedLoading: true, chunkProgress: updateProgressBar, maxClusterRadius: 60});
			var marker_list = [];
			var cities;
			var year = "2012";
			$.getJSON("assets/data/geodata.json", function(json){
				cities = json;
			});
			$.getJSON("assets/data/data.json", function(crimes){
				for(state in crimes.data[year])
				{
					marker_list = []
					for(crime_index in crimes.data[year][state])
					{
						crime = crimes.data[year][state][crime_index];
						var city = crime[0];
						if(state == "DELHI" || state == "SIKKIM")	
						{
							city = state + " " + city; 
						}
						if(cities[city] != null)
						{
							for(var i=1; i <= parseInt(crime[12]); i++)
							{
									var marker = L.marker(new L.LatLng(cities[city][0], cities[city][1]), { title: city });
									marker.bindPopup(city);
									marker_list.push(marker);
							}
						}
					}
					markers.addLayers(marker_list);
				}
				map.addLayer(markers);
			});	
		</script>
	</body>	
</html>

