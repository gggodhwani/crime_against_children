<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Crime Against Children in India</title>
		<meta name="description" content="">
		<link href="assets/css/bootstrap.min.css" rel="stylesheet">
		<link href="assets/css/bootstrap-responsive.min.css" rel="stylesheet">
		<link href="assets/css/leaflet.css" rel="stylesheet">
		<link href="assets/css/MarkerCluster.css" rel="stylesheet">
		<link href="assets/css/MarkerCluster.Default.css" rel="stylesheet">
		<link href="assets/css/bootstrap-select.min.css" rel="stylesheet">
		<link href="assets/css/style.css" rel="stylesheet">
	</head>
	<body>
		<div class="container">
			<div class="mashead">
				<h3>Crime Against Children in India</h3>
				<nav class="navbar navbar-default" role="navigation">
					<div class="collapse navbar-collapse">
						<ul class="nav navbar-nav">
							<li class="active"><a href="#">Home</a></li>
							<li><a href="#">Visualizations</a></li>
							<li><a href="#">About Us</a></li>
						</ul>
					</div>	
				</nav>	
			</div>	

			<div>
				<p class="lead">The data has been taken from <a href="http://data.gov.in/">Open Government Data (OGD) Platform India</a> and refers to details on district wise crimes against Children under various crime categories such as Murder, Rape, Kidnapping and Abduction, Foeticide, Abetment of suicide, Exposure and abandonment, Procuration of minor girls, Buying of girls for prostitution, Selling of girls for prostitution, Prohibition of child marriage act and Other Crimes.</p>
			</div>
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">Displaying Data of Year 2012</h3>
				</div>
				<div class="panel-body">
					<select id="year_list" class="selectpicker">
						<option selected="selected">2012</option> 
						<option>2011</option> 
						<option>2010</option> 
						<option>2009</option> 
						<option>2008</option> 
						<option>2007</option> 
						<option>2006</option> 
						<option>2005</option> 
						<option>2004</option> 
						<option>2003</option> 
						<option>2002</option> 
						<option>2001</option> 
					</select>
					<select id="states_list" class="selectpicker">
						<option selected="selected" value="default">Focus on a State</option> 
					</select>
				</div>
			</div>
			<div id="progress" class="progress progress-striped active"><div id="progress-bar" class="progress-bar" role="progressbar"  aria-valuemin="0" aria-valuemax="100" style="width: 30%">Loading</div></div>
			<div id="map"></div>
		</div>	
		<script src="assets/js/google-maps.js"></script>
		<script src="assets/js/jquery.min.js" type="text/javascript"></script>
		<script src="assets/js/bootstrap.min.js"></script>
		<script src="assets/js/leaflet.js"></script>
		<script src="assets/js/leaflet.markercluster-src.js"></script>
		<script src="assets/js/leaflet-google.js"></script>
		<script src="assets/js/bootstrap-select.min.js"></script>
		<script type="text/javascript">
			var googleLayer = new L.Google('ROADMAP');
			var map = new L.Map('map', {center: new L.LatLng(22, 78), zoom: 5});
			map.addLayer(googleLayer);
			
			var progress = document.getElementById('progress');
			var progressBar = document.getElementById('progress-bar');
			function updateProgressBar(processed, total, elapsed, layersArray)
			{
				if (elapsed > 5) 
				{
					progress.style.display = 'block';
					loaded_value = Math.round(processed/total*500)
					progressBar.style.width = loaded_value + '%';
				}
				if (processed === total) 
				{
					// all markers processed - hide the progress bar:
					progress.style.display = 'none';
				}
			}
			var markers = null;
			var marker_list = [];
			var is_states_populated = false;
                        var cities;
			var year = "2012";
			$.getJSON("assets/data/geodata.json", function(json){
				cities = json;
			});
                        populate_map_for_year(year);
                        function populate_map_for_year(year)
                        {
			    if(markers != null)
			    {
			        map.removeLayer(markers);
			    }
			    markers = L.markerClusterGroup({ chunkedLoading: true, chunkProgress: updateProgressBar, maxClusterRadius: 60});
                            $.getJSON("assets/data/yearwise_crime_data/" + year +".json", function(crimes){
                                for(state in crimes.data[year])
                                {
                                    marker_list = [];
                                    if(!is_states_populated)
                                    {    
                                        $("#states_list").append('<option value="' + state.toLowerCase().replace(/ /g, "_") +'">' + state + '</option>');
                                    }
                                    for(crime_index in crimes.data[year][state])
                                    {
                                        crime = crimes.data[year][state][crime_index];
                                        var city = crime[0];
                                        if(state == "DELHI" || state == "SIKKIM")	
                                        {
                                            city = state + " " + city; 
                                        }
                                        if(cities[city] != null)
                                        {
                                            for(var i=1; i <= parseInt(crime[12]); i++)
                                            {
                                                var marker = L.marker(new L.LatLng(cities[city][0], cities[city][1]), { title: city });
                                                marker.bindPopup(city);
                                                marker_list.push(marker);
                                            }
                                        }
                                    }       
                                    markers.addLayers(marker_list);
                                }
                                map.addLayer(markers);
                                if(!is_states_populated)
                                {    
                                    $('select').show();
                                    $('select').selectpicker();
                                    is_states_populated = true;
                                }
                            });
                        }    	
			$("#year_list").change(function()
			{
			    year = $("#year_list option:selected").text();
                            populate_map_for_year(year);
			});
                        var selected_state_layer = null;
			$("#states_list").change(function()
			{
				if(selected_state_layer != null)
				{
					map.removeLayer(selected_state_layer);
				}
				state_name = $("#states_list option:selected").val();
                                if(state_name == "default")
                                {

                                }
				$.getJSON("assets/data/state_boundaries/" + state_name + ".json", function(json){
					polygon_features = {weight: 1, fillOpacity: 0.15}; 
					if(json["type"] = "MultiPolygon")
					{
						selected_state_layer = L.multiPolygon(json["coordinates"], polygon_features); 
					}
					else
					{
						selected_state_layer = L.polygon(json["coordinates"], polygon_features);
					}	
					map.addLayer(selected_state_layer);
					area = parseFloat(json["area_sqkm"]);
					zoom_level = 7;
					if(area < 5000)
					{
						zoom_level = 10;
					}
					else if(area < 10000)
					{
						zoom_level = 9;
					}
					else if(area < 20000)
					{
						zoom_level = 8;
					}
					map.setView(new L.LatLng(json["center"][0], json["center"][1]), zoom_level);
				});
			});
		</script>
	</body>	
</html>
